!function($){flowplayer(function(api,root){if(!api.pluginQualitySelectorEnabled){api.pluginQualitySelectorEnabled=!0;var canPlay=function(type){var videoTag=document.createElement("video");return!!videoTag.canPlayType(type).replace("no","")};if(!flowplayer.support.video||flowplayer.support.inlineVideo&&!canPlay("application/x-mpegurl")){var getQualityFromSrc=function(src){var m=/-(\d+p)\.(mp4|webm)$/.exec(src);if(m)return m[1]};if(api.conf.qualities){api.conf.qualities=api.conf.qualities.split(","),root.on("click",".fp-quality-selector li",function(){var currentTime=api.finished?0:api.video.time,quality=$(this).data("quality"),isDefaultQuality=quality===api.conf.defaultQuality,src=api.video.src.replace(/(-\d+p)?\.(mp4|webm)$/,isDefaultQuality?".$2":"-"+quality+".$2");api.quality=quality,api.load(src,function(){api.finished=!1,currentTime&&api.seek(currentTime,function(){api.resume()})})});var findOptimalQuality=function(previousQuality,newQualities){var ret,a=parseInt(previousQuality,0);return $.each(newQualities,function(i,quality){return i==newQualities.length-1?(ret=quality,!1):parseInt(quality)<=a&&parseInt(newQualities[i+1])>a?(ret=quality,!1):void 0}),ret};api.bind("load",function(ev,api,video){if(api.quality){var playlistItemEl=root.find('.fp-playlist [data-index="'+video.index+'"]'),qualities=api.conf.qualities=api.conf.playlist.length?api.conf.playlist[video.index].qualities||(playlistItemEl.data("qualities")?playlistItemEl.data("qualities").split(","):api.conf.qualities):api.conf.qualities,desiredQuality=findOptimalQuality(api.quality,qualities),isDefaultQuality=api.conf.playlist.length?desiredQuality==(api.conf.playlist[video.index].defaultQuality||(playlistItemEl.data("defaultQuality")?playlistItemEl.data("defaultQuality"):api.conf.defaultQuality)):desiredQuality==api.conf.defaultQuality,src=video.src.replace(/(-\d+p)?\.(mp4|webm)$/,isDefaultQuality?".$2":"-"+desiredQuality+".$2");video.src!==src&&(ev.preventDefault(),api.loading=!1,api.load(src))}}),api.bind("ready",function(ev,api,video){var quality=getQualityFromSrc(video.src)||Math.min(video.height,video.width)+"p";$.each(api.conf.qualities,function(i,quality){root.removeClass("quality-"+quality)}),api.quality=quality,root.addClass("quality-"+quality);var ui=root.find(".fp-ui");if(ui.find(".fp-quality-selector").remove(),!(api.conf.qualities.length<2)){var selector=$('<ul class="fp-quality-selector"></ul>').appendTo(ui);$.each(api.conf.qualities,function(i,q){selector.append($("<li>"+q+"</li>").data("quality",q).toggleClass("active",q==quality))})}})}}}})}(window.jQuery);